language: rust
cache: cargo
dist: trusty
sudo: true
before_install:
  - curl -L https://github.com/mozilla/grcov/releases/latest/download/grcov-linux-x86_64.tar.bz2 | tar jxf -
before_cache:
  - cargo prune
  - |
    if [[ "$TRAVIS_RUST_VERSION" == nightly ]]; then
      cargo install grcov
    fi
before_script:
  - |
    (which cargo-install-update && cargo install-update cargo-update) || cargo install cargo-update &&
    (which cargo-prune && cargo install-update cargo-prune) || cargo install cargo-prune
os:
- linux
rust:
- stable
- nightly
script:
- cargo clean
- cargo test --verbose
after_success:
  - |
    if [[ "$TRAVIS_RUST_VERSION" == nightly ]]; then
      grcov target/debug -t lcov > lcov.info
      bash <(curl -s https://codecov.io/bash) -f lcov.info
    fi
